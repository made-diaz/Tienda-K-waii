<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style> html, body{height: 100%} body{display: flex; flex-direction: column} main{flex: 1} </style>

    <title>Inicio | Mi tienda </title>
</head>
<body>
<div id="navbar-container"></div>
<main>
    <!-- Carrusel -->
    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="https://picsum.photos/seed/oferta1/1200/380" class="d-block w-100" alt="Oferta 1">
                <div class="carousel-caption d-none d-md-block">
                    <h2 class="fw-bold">Ofertas imperdibles</h2>
                    <p>Descuentos por tiempo limitado.</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="https://picsum.photos/seed/oferta2/1200/380" class="d-block w-100" alt="Oferta 2">
                <div class="carousel-caption d-none d-md-block">
                    <h2 class="fw-bold">Ofertas imperdibles</h2>
                    <p>Encuentra tus favoritos al mejor precio.</p>
                </div>
            </div>
            <div class="carousel-item">
                <img src="https://picsum.photos/seed/oferta3/1200/380" class="d-block w-100" alt="Oferta 3">
                <div class="carousel-caption d-none d-md-block">
                    <h2 class="fw-bold">Ofertas imperdibles</h2>
                    <p>Stock limitado. ¡Aprovecha!</p>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="mb-0">Productos destacados</h3>
            <div>


                <!-- AGREGAR IMAGENES-->

            </div>
            <a class="btn btn-outline-primary btn-sm" href="catalogo.html">Ver catálogo</a>
        </div>

        <div class="row g-4" id="destacados"></div>
    </div>
</main>

<div id="footer-container"></div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/auth.js"></script>
<script src="assets/js/layout.js"></script>
<script>
    const PROD_KEY = "APP_PRODS";
    const CART_KEY = "APP_CART";
    const fmt = new Intl.NumberFormat('es-CL', { style:'currency', currency:'CLP', maximumFractionDigits:0 });

    function getProds(){ try { return JSON.parse(localStorage.getItem(PROD_KEY))||[]; } catch { return []; } }
    function getCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY))||[]; } catch { return []; } }
    function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); window.dispatchEvent(new CustomEvent('cart:updated')); }

    function renderDestacados(){
        const prods = getProds();
        const $wrap = $('#destacados').empty();
        if(!prods.length){
            $wrap.append(`<div class="col-12"><div class="alert alert-info">Aún no hay productos. Cárgalos en Admin.</div></div>`);
            return;
        }
        // mostrar hasta 3 primeros (o elige aleatorios si quieres)
        prods.slice(0,3).forEach(p=>{
            const imgSrc = p.img || `https://picsum.photos/seed/prod${p.id}/600/400`;
            $wrap.append(`
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="card h-100">
              <img src="${imgSrc}" class="card-img-top" alt="${p.nombre}">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">${p.nombre}</h5>
                <p class="text-muted small mb-2">Stock: ${p.stock}</p>
                <div class="mt-auto d-flex justify-content-between align-items-center">
                  <span class="fw-bold">${fmt.format(Number(p.precio)||0)}</span>
                  <button class="btn btn-primary btn-sm addToCart" data-id="${p.id}" data-name="${p.nombre}" data-price="${p.precio}">Agregar</button>
                </div>
              </div>
            </div>
          </div>
        `);
        });
    }

    $(function(){
        // Obliga login si entran directo por URL
        const user = AuthStore.getCurrentUser();
        if(!user){ location.href='login.html'; return; }

        Layout.loadPartials();
        renderDestacados();

        $(document).on('click', '.addToCart', function(){
            const id = Number($(this).data('id'));
            const name = $(this).data('name');
            const price = Number($(this).data('price'))||0;
            const cart = getCart();
            const found = cart.find(i=>i.id===id);
            if(found){ found.qty = (found.qty||1)+1; }
            else { cart.push({id, name, price, qty:1}); }
            saveCart(cart);
        });
    });
</script>

</body>
</html>