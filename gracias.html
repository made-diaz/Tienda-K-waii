<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gracias por tu compra | Tienda K-waii</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="icon" href="assets/image/logoSinFondo.png" type="image/x-icon">
    <style>
        .ok-icon { font-size: 64px }
        /* Loader overlay */
        .loader-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #ffffff;
            z-index: 1200;
            flex-direction: column;
            gap: 1rem;
        }
        .loader-text { font-size: 1.125rem; font-weight: 500; }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">

<!-- Loader: visible al inicio -->
<div class="loader-overlay" id="pageLoader" role="status" aria-live="polite" aria-busy="true">
    <div class="spinner-border" role="status" aria-hidden="true" style="width:3rem;height:3rem"></div>
    <div class="loader-text">Cargando...</div>
</div>

<div id="navbar-container"></div>

<!-- Contenido principal: oculto hasta que termine el "cargando" -->
<main id="mainContent" class="container py-5 flex-grow-1 d-none" aria-hidden="true">
    <div class="text-center">
        <div class="ok-icon mb-3">✅</div>
        <h1 class="mb-3">¡Gracias por tu compra!</h1>
        <p class="lead">Tu pedido ha sido procesado correctamente.</p>
        <div class="card mx-auto my-4" style="max-width: 480px;">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <span class="fw-semibold">N° de pedido</span>
                    <span id="orderNumber"></span>
                </div>
                <div class="d-flex justify-content-between mt-2">
                    <span class="fw-semibold">Total pagado</span>
                    <span id="orderTotal">$0</span>
                </div>
            </div>
        </div>
        <a id="btnDark" href="index.html" class="btn btn-primary">Volver al inicio</a>
    </div>
</main>

<div id="footer-container" class="d-none" aria-hidden="true"></div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="assets/js/auth.js"></script>
<script src="assets/js/layout.js"></script>
<script>
    function genOrderNumber() {
        // Formato simple: AAA-123456 (aleatorio)
        const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        const A = letters[Math.floor(Math.random()*26)];
        const B = letters[Math.floor(Math.random()*26)];
        const C = letters[Math.floor(Math.random()*26)];
        const num = String(Math.floor(Math.random()*900000)+100000);
        return `${A}${B}${C}-${num}`;
    }

    $(function () {
        // Guard: si no hay usuario logueado -> login
        const user = AuthStore.getCurrentUser();
        if(!user) { location.href = 'login.html'; return; }

        // Cargamos partials (navbar/footer). Pueden tardar, pero dejamos loader 3s
        Layout.loadPartials();

        // Duración del "cargando..." en ms
        const LOADER_MS = 3000;

        // Mantener el overlay visible LOADER_MS, luego mostrar contenido
        setTimeout(() => {
            // Oculta el loader (con un pequeño fade)
            $('#pageLoader').fadeOut(300, function() { $(this).remove(); });

            // Mostrar main y footer
            $('#mainContent').removeClass('d-none').attr('aria-hidden', 'false');
            $('#footer-container').removeClass('d-none').attr('aria-hidden', 'false');

            // Poner total y número de pedido
            const total = sessionStorage.getItem('LAST_ORDER_TOTAL') || '$0';
            $('#orderTotal').text(total);
            $('#orderNumber').text(genOrderNumber());
        }, LOADER_MS);
    });
</script>
</body>
</html>
